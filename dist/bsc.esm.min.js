import{ethers as e}from"ethers";import{Logger as r}from"@ethersproject/logger";import{PocketProvider as n,WebSocketProvider as t,UrlJsonRpcProvider as s}from"@ethersproject/providers";import{defineReadOnly as o}from"@ethersproject/properties";const a="@ethers-ancillary/bsc@0.0.2",i=new e.utils.Logger(a),c=[{name:"bsc-mainnet",chainId:56},{name:"bsc-testnet",chainId:97}];function u(e){if(null==e)return null;if("number"==typeof e){const r=c.filter((r=>r.chainId===e));return r.length?{name:r[0].name,chainId:r[0].chainId}:{name:"unknown",chainId:e}}if("string"==typeof e){const r=c.filter((r=>r.name===e));return r.length?{name:r[0].name,chainId:r[0].chainId}:null}if("string"==typeof e.name&&"number"==typeof e.chainId){const r=u(e.name),n=u(e.chainId);if(null==r&&null==n)return{name:e.name,chainId:e.chainId};if(r&&n&&r.name===n.name&&r.chainId===n.chainId)return r}return i.throwArgumentError("network chainId mismatch","network",e)}const l=new e.utils.Logger(a);class p extends e.providers.EtherscanProvider{constructor(r,n){const t=u(null==r?"bsc-mainnet":r);switch((t||{}).name){case"bsc-mainnet":case"bsc-testnet":break;default:l.throwError("unsupported network",e.utils.Logger.errors.UNSUPPORTED_OPERATION,{network:r})}super(t,n||"EVTS3CU31AATZV72YQ55TPGXGMVIFUQ9M9")}getBaseUrl(){switch(this.network?this.network.name:"invalid"){case"bsc-mainnet":return"http://api.bscscan.com";case"bsc-testnet":return"http://api-testnet.bscscan.com"}return l.throwArgumentError("unsupported network","network",this.network)}isCommunityResource(){return"EVTS3CU31AATZV72YQ55TPGXGMVIFUQ9M9"===this.apiKey}}const m=new r(a);class h extends n{constructor(e,n){const t=u(e||"bsc-mainnet");t||m.throwError("unsupported network",r.errors.INVALID_ARGUMENT,{argument:"network",value:e}),n||(n={applicationId:"6136201a7bad1500343e248d",loadBalancer:!0}),super(t,n)}static getUrl(e,n){let t=null;switch(e?e.name:"unknown"){case"bsc-mainnet":t="bsc-mainnet.gateway.pokt.network";break;default:m.throwError("unsupported network",r.errors.INVALID_ARGUMENT,{argument:"network",value:e})}const s={url:`https://${t}/v1/lb/${n.applicationId}`,headers:{}};return null!=n.applicationSecretKey&&(s.user="",s.password=n.applicationSecretKey),s}isCommunityResource(){return"6136201a7bad1500343e248d"===this.applicationId}}const d=new r(a);class w extends t{constructor(e,r){const n=new b(e,r);super(`${n.connection.url.replace(/^http/i,"ws")}/ws`,e),o(this,"apiKey",n.apiKey)}isCommunityResource(){return!1}}class b extends s{constructor(e,n){const t=u(e||"bsc-mainnet");switch((t||{}).name){case"bsc-mainnet":case"bsc-testnet":break;default:d.throwError("unsupported network",r.errors.UNSUPPORTED_OPERATION,{network:e})}null==n&&d.throwError("no default apiKey",r.errors.INVALID_ARGUMENT,{argument:"apiKey",value:n}),super(t,n)}static getApiKey(e){const n={apiKey:null,region:"nyc"};return"string"==typeof e?n.apiKey=e:(null!=e.apiKey&&(n.apiKey=e.apiKey),null!=e.region&&(n.region=n.region)),null==n.apiKey&&d.throwError("apiKey is invalid",r.errors.INVALID_ARGUMENT,{argument:"apiKey",value:e}),n}static getUrl(e,n){let t=null;switch(e?e.name:"unknown"){case"bsc-mainnet":t="bsc/mainnet";break;case"bsc-testnet":t="bsc/testnet";break;default:d.throwError("unsupported network",r.errors.INVALID_ARGUMENT,{argument:"network",value:e})}const s={url:`https://speedy-nodes-${n.region}.moralis.io/${n.apiKey}/${t}`,headers:{}};return s}isCommunityResource(){return!1}}function g(r,n){const t=[];return t.push(new p(r,(n||{}).bscscan||void 0)),t.push(new h(r,(n||{}).bscpocket||void 0)),n&&n.bscmoralis&&("string"==typeof n.bscmoralis||n.bscmoralis.apiKey)&&t.push(new b(r,n.bscmoralis)),new e.providers.FallbackProvider(t,Math.min(t.length,2))}export{b as BscMoralisProvider,w as BscMoralisWebSocketProvider,h as BscPocketProvider,p as BscscanProvider,g as getDefaultProvider,u as getNetwork};
